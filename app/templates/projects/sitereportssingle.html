<!-- overview of project site reports go here -->
{% block body %}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12" align="center">
            <div class="panel panel-default">
                <div class="panel-heading">Site Report for {{ pname }} by {{ userstamp }}</div>
                <div class="panel-body">
                    <div class="click2edit" id="editor">
                        {{ html|safe }}
                    </div>


                </div>
            </div>
            <p>
                <button id="edit" class="btn btn-default" onclick="edit()">Edit</button>
                <button id="save" class="btn btn-primary" onclick="save()" disabled>Save</button>
                <button id="back" class="btn btn-primary" onclick="back()">Back</button>
            </p>
        </div>
    </div>
</div>


{% endblock %}


{% block js %}

<script>
var pid = {{ pid }};
var sid = {{ sid }};
 </script>

  <script>
 var edit = function() {
    $('.click2edit').summernote({focus: true});
    $('#save').prop('disabled', false);
  };


  var save = function() {
    var myHtml = $('.click2edit').summernote('code');
    myHtml = myHtml.replace(/\n/g, "").trim().replace(/\>[\t ]+\</g, "><");

  var data = {
            html : myHtml
            }

      $.post(pid + '/api/sitereports/' + sid + '/', data, function (res) {
            console.log(res)

            $('.click2edit').summernote('destroy');
            $('#save').prop('disabled', true);


    }).fail(function(err, status) {
        // something went wrong
        console.log('AJAX post failed');
    });


  };

   var back = function() {
   // TODO need this to know if we came from site report list or dashboard (maybe just call browser back?)
    $.ajax(pid + '/sitereports/').done(function (res) {
            $('#cont-area').html(res);
    });
  };
</script>



{% endblock %}